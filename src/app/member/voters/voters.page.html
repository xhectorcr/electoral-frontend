<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Padr贸n de Votantes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="page-background">
  <ion-refresher slot="fixed" (ionRefresh)="loadVoters($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-searchbar
    [(ngModel)]="searchTerm"
    placeholder="Buscar por DNI o nombre"
    [debounce]="300"
    (ionInput)="filterVoters()"
    animated="true"
    class="custom-searchbar"
  ></ion-searchbar>

  <ion-segment
    [(ngModel)]="selectedSegment"
    (ionChange)="filterVoters()"
    color="primary"
    class="sticky-segment"
  >
    <ion-segment-button value="all">
      <ion-label>Todos</ion-label>
    </ion-segment-button>
    <ion-segment-button value="pending">
      <ion-label>Pendientes</ion-label>
    </ion-segment-button>
    <ion-segment-button value="voted">
      <ion-label>Votaron</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="isLoading" class="status-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Cargando padr贸n de mesa...</p>
  </div>

  <div *ngIf="errorMessage" class="status-container error">
    <ion-icon name="alert-circle" color="danger"></ion-icon>
    <p>{{ errorMessage }}</p>
  </div>

  <ion-list class="voter-list" *ngIf="!isLoading && !errorMessage">
    <ion-list-header>
      Mostrando {{ filteredVoters.length }} de {{ allVoters.length }} votantes
    </ion-list-header>

    <ion-item
      *ngIf="filteredVoters.length === 0"
      lines="none"
      class="no-results-item"
    >
      <ion-icon name="sad-outline" slot="start" color="medium"></ion-icon>
      <ion-label>No se encontraron votantes que coincidan.</ion-label>
    </ion-item>

    <ion-item-sliding
      *ngFor="let voter of filteredVoters; trackBy: trackVoter"
      #slidingItem
    >
      <ion-item-options side="start">
        <ion-item-option
          color="success"
          (click)="markAsVoted(voter, slidingItem)"
          *ngIf="!voter.hasVoted"
        >
          <ion-icon slot="icon-only" name="checkmark-circle"></ion-icon>
          Vot贸
        </ion-item-option>
      </ion-item-options>

      <ion-item class="voter-item">
        <ion-icon
          name="person-circle-outline"
          slot="start"
          class="voter-icon"
          [color]="voter.hasVoted ? 'success' : 'medium'"
        ></ion-icon>
        <ion-label>
          <h2>{{ voter.fullName }}</h2>
          <p>DNI: {{ voter.documentNumber }}</p>
        </ion-label>
        <ion-chip
          [color]="voter.hasVoted ? 'success' : 'light'"
          slot="end"
          outline="true"
        >
          <ion-label>{{ voter.hasVoted ? 'Vot贸' : 'Pendiente' }}</ion-label>
        </ion-chip>
      </ion-item>

      <ion-item-options side="end">
        <ion-item-option
          color="danger"
          (click)="reportIncident(voter, slidingItem)"
        >
          <ion-icon slot="icon-only" name="alert-circle"></ion-icon>
          Reportar
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>
</ion-content>
