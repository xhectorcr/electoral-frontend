<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Reporte de Incidentes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="page-background">
  <ion-refresher slot="fixed" (ionRefresh)="loadIncidents($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-segment
    [(ngModel)]="selectedSegment"
    (ionChange)="filterIncidents()"
    color="primary"
    class="sticky-segment"
  >
    <ion-segment-button value="all">
      <ion-label>Todos</ion-label>
    </ion-segment-button>
    <ion-segment-button [value]="IncidentStatus.PENDIENTE">
      <ion-label>Pendientes</ion-label>
    </ion-segment-button>
    <ion-segment-button [value]="IncidentStatus.RESUELTO">
      <ion-label>Resueltos</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div *ngIf="isLoading" class="status-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Cargando incidentes...</p>
  </div>

  <div *ngIf="errorMessage" class="status-container error">
    <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
    <p>{{ errorMessage }}</p>
  </div>

  <ion-list class="incident-list" *ngIf="!isLoading && !errorMessage">
    <ion-list-header>
      Mostrando {{ filteredIncidents.length }} incidentes
    </ion-list-header>

    <ion-item
      *ngIf="filteredIncidents.length === 0"
      lines="none"
      class="no-results-item"
    >
      <ion-icon name="sad-outline" slot="start" color="medium"></ion-icon>
      <ion-label>No hay incidentes para mostrar.</ion-label>
    </ion-item>

    <ion-item
      *ngFor="let incident of filteredIncidents; trackBy: trackIncident"
      class="incident-item"
      lines="none"
      button
      (click)="viewIncident(incident)"
    >
      <ion-icon
        [name]="getIconForType(incident.type)"
        slot="start"
        class="incident-icon"
        [color]="incident.status === IncidentStatus.RESUELTO ? 'medium' : 'danger'"
      ></ion-icon>
      <ion-label>
        <h2>{{ incident.title }}</h2>
        <p>
          {{ incident.createdAt | date: 'd MMM, h:mm a' }} - {{ incident.type }}
        </p>
      </ion-label>
      <ion-chip
        [color]="incident.status === IncidentStatus.RESUELTO ? 'success' : 'danger'"
        slot="end"
        outline="true"
        class="status-chip"
      >
        <ion-label>
          {{ incident.status === IncidentStatus.RESUELTO ? 'Resuelto' :
          'Pendiente' }}
        </ion-label>
      </ion-chip>
    </ion-item>
  </ion-list>

  <ion-fab
    slot="fixed"
    vertical="bottom"
    horizontal="end"
    (click)="presentIncidentModal()"
  >
    <ion-fab-button color="danger">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
