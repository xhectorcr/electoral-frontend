<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Elecciones Perú 2026</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="section-title">Candidatos 2026</div>

  <ion-item class="search-item" lines="none">
    <ion-icon name="search-outline" slot="start"></ion-icon>
    <ion-input
      placeholder="Buscar por nombre o partido"
      [(ngModel)]="searchTerm"
      (ionInput)="filterCandidates()"
      [clearInput]="true"
    ></ion-input>
  </ion-item>

  <ion-segment
    [(ngModel)]="selectedTag"
    (ionChange)="filterCandidates()"
    color="primary"
    scrollable="true"
    class="tags-segment"
  >
    <ion-segment-button *ngFor="let tag of tags" [value]="tag">
      <ion-label>{{ tag }}</ion-label>
    </ion-segment-button>
  </ion-segment>

  <div class="results-summary">
    Mostrando {{ filteredCandidates.length }} de {{ candidates.length }}
    candidatos
  </div>

  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Cargando candidatos...</p>
  </div>

  <div
    *ngIf="!isLoading && filteredCandidates.length === 0"
    class="empty-state"
  >
    <ion-icon name="sad-outline" color="medium"></ion-icon>
    <p>No se encontraron candidatos que coincidan con tu búsqueda.</p>
  </div>

  <div class="candidates-grid" *ngIf="!isLoading">
    <ion-card
      *ngFor="let candidate of filteredCandidates"
      class="candidate-card"
    >
      <img
        [src]="candidate.imageUrl"
        alt="{{ candidate.fullName }}"
        class="candidate-photo"
        (error)="onImageError($event, candidate)"
      />
      <ion-card-header>
        <div class="party-badge">{{ candidate.partyName }}</div>
        <ion-card-title>{{ candidate.fullName }}</ion-card-title>
        <ion-card-subtitle>{{ candidate.office }}</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content class="card-content-wrapper">
        <ul class="info-list">
          <li>
            <ion-icon name="map-outline" color="primary"></ion-icon>
            <ion-note
              >Postula por: <strong>{{ candidate.region }}</strong></ion-note
            >
          </li>
          <li>
            <ion-icon name="school-outline" color="primary"></ion-icon>
            <ion-note
              >{{ candidate.hdv?.academicFormation | slice: 0:45 }}...</ion-note
            >
          </li>
          <li>
            <ion-icon name="briefcase-outline" color="primary"></ion-icon>
            <ion-note
              >{{ candidate.hdv?.employmentRecord | slice: 0:45 }}...</ion-note
            >
          </li>
        </ul>

        <ion-button
          class="details-button"
          expand="full"
          fill="solid"
          color="primary"
          (click)="viewDetails(candidate)"
        >
          Ver Perfil Completo
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
